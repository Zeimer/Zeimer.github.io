<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="coqdoc.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery-1.8.3.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MyStyles.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88023543-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<h1 class="libtitle">R3: Taktyki i automatyzacja</h1>

<div class="code">
</div>

<div class="doc">

<div class="paragraph"> </div>

 Matematycy uważają, że po osiągnięciu pewnego poziomu zaawansowania i
    obycia (nazywanego zazwyczaj "mathematical maturity") skrupulatne
    rozpisywanie każdego kroku dowodu przestaje mieć sens i pozwalają
    sobie zarzucić je na rzecz bardziej wysokopoziomowego opisu rozumowania.

<div class="paragraph"> </div>

    Myślę, że ta sytuacja ma miejsce w twoim przypadku — znasz już sporą
    część języka termów Coqa (zwanego Gallina) i potrafisz dowodzić różnych
    właściwości programów. Doszedłeś do punktu, w którym ręczne klepanie
    dowodów przestaje być produktywne, a staje się nudne i męczące.

<div class="paragraph"> </div>

    Niestety, natura dowodu formalnego nie pozwala nam od tak po prostu
    pominąć mało ciekawych kroków. Czy chcemy czy nie, aby Coq przyjął
    dowód, kroki te muszą zostać wykonane. Wcale nie znaczy to jednak,
    że to my musimy je wykonać — mogą zrobić to za nas programy.

<div class="paragraph"> </div>

    Te programy to oczywiście taktyki. Większość prymitywnych taktyk, jak
    <span class="inlinecode"><span class="id" title="tactic">intro</span></span>, <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>, czy <span class="inlinecode"><span class="id" title="tactic">assumption</span></span> już znamy. Choć nie wiesz o tym,
    używaliśmy też wielokrotnie taktyk całkiem zaawansowanych, takich jak
    <span class="inlinecode"><span class="id" title="tactic">induction</span></span> czy <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>, bez których nasze formalne życie byłoby
    drogą przez mękę.

<div class="paragraph"> </div>

    Wszystkie one są jednak taktykami wbudowanymi, danymi nam z góry przez
    Coqowych bogów i nie mamy wpływu na ich działanie. Jeżeli nie jesteśmy
    w stanie zrobić czegoś za ich pomocą, jesteśmy zgubieni. Czas najwyższy
    nauczyć się pisać własne taktyki, które pomogą nam wykonywać mało ciekawe
    kroki w dowodach, a w dalszej perspektywnie także przeprowadzać bardziej
    zaawansowane rozumowania zupełnie automatycznie.

<div class="paragraph"> </div>

    W tym rozdziale poznamy podstawy języka <span class="inlinecode"><span class="id" title="keyword">Ltac</span></span>, który służy do tworzenia
    własnych taktyk. Jego składnię przedstawiono i skrupulatnie opisano tu:
    https://coq.inria.fr/refman/ltac.html

<div class="paragraph"> </div>

    Choć przykład znaczy więcej niż 0x3E8 stron manuala i postaram się
    dokładnie zilustrować każdy istotny moim zdaniem konstrukt języka
    <span class="inlinecode"><span class="id" title="keyword">Ltac</span></span>, to i tak polecam zapoznać się z powyższym linkiem.

<div class="paragraph"> </div>

    Upewnij się też, że rozumiesz dokładnie, jak działają podstawowe
    kombinatory taktyk, które zostały omówione w rozdziale 1, gdyż nie
    będziemy omawiać ich drugi raz. 
<div class="paragraph"> </div>

<a name="lab151"></a><h1 class="section">Zarządzanie celami i selektory</h1>

<div class="paragraph"> </div>

 Dowodząc (lub konstruując cokolwiek za pomocą taktyk) mamy do rozwiązania
    jeden lub więcej celów. Cele są ponumerowane i domyślnie zawsze pracujemy
    nad tym, który ma numer 1.

<div class="paragraph"> </div>

    Jednak wcale nie musi tak być — możemy zaznaczyć inny cel i zacząć nad
    nim pracować. Służy do tego komenda <span class="inlinecode"><span class="id" title="var">Focus</span></span>. Cel o numerze n możemy
    zaznaczyć komendą <span class="inlinecode"><span class="id" title="var">Focus</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. Jeżeli to zrobimy, wszystkie pozostałe cele
    chwilowo znikają. Do stanu domyślnego, w którym pracujemy nad celem nr 1
    i wszystkie cele są widoczne możemy wrócić za pomocą komendy <span class="inlinecode"><span class="id" title="var">Unfocus</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Goal</span> <span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Prop</span>, <a class="idref" href="R3.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="R3.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#P"><span class="id" title="variable">P</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Focus</span> 3.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unfocus</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Focus</span> 2.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
Komenda <span class="inlinecode"><span class="id" title="var">Focus</span></span> jest użyteczna głównie gdy któryś z dalszych celów jest
    łatwiejszy niż obecny. Możemy wtedy przełączyć się na niego, rozwiązać
    go i wyniesione stąd doświadczenie przenieść na trudniejsze cele. Jest
    wskazane, żeby po zakończeniu dowodu zrefaktoryzować go tak, aby komenda
    <span class="inlinecode"><span class="id" title="var">Focus</span></span> w nim nie występowała.

<div class="paragraph"> </div>

    Nie jest też tak, że zawsze musimy pracować nad celem o numerze 1. Możemy
    pracować na dowolnym zbiorze celów. Do wybierania celów, na które chcemy
    zadziałać taktykami, służą selektory. Jest ich kilka i mają taką składnię:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">n</span>:</span> <span class="inlinecode"><span class="id" title="var">t</span></span> — użyj taktyki t na n-tym celu. <span class="inlinecode">1:</span> <span class="inlinecode"><span class="id" title="var">t</span></span> jest równoważne <span class="inlinecode"><span class="id" title="var">t</span></span>.

</li>
<li> <span class="inlinecode"><span class="id" title="var">a</span>-<span class="id" title="var">b</span>:</span> <span class="inlinecode"><span class="id" title="var">t</span></span> — użyj taktyki t na wszystkich celach o numerach od a do b

</li>
<li> <span class="inlinecode"><span class="id" title="var">a1</span>-<span class="id" title="var">b1</span>,</span> <span class="inlinecode"><span class="id" title="var">a2</span>-<span class="id" title="var">b2</span>,</span> <span class="inlinecode">...,</span> <span class="inlinecode"><span class="id" title="var">aN</span>-<span class="id" title="var">bN</span>:</span> <span class="inlinecode"><span class="id" title="var">t</span></span> — użyj taktyki <span class="inlinecode"><span class="id" title="var">t</span></span> na wszystkich celach
      o numerach od a1 do b1, od a2 do b2, ..., od aN do bN (zamiast aK-bK
      możemy też użyć pojedynczej liczby)

</li>
<li> <span class="inlinecode"><span class="id" title="var">all</span>:</span> <span class="inlinecode"><span class="id" title="var">t</span></span> ­- użyj <span class="inlinecode"><span class="id" title="var">t</span></span> na wszystkich celach 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Goal</span> <span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Prop</span>, <a class="idref" href="R3.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="R3.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="R3.html#P"><span class="id" title="variable">P</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H''</span>]]. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;3: <span class="id" title="tactic">assumption</span>. 2: <span class="id" title="tactic">assumption</span>. 1: <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H''</span>]]. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;1-2: <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H''</span>]]. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;1-2, 3: <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> [<span class="id" title="var">H'</span> <span class="id" title="var">H''</span>]]. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Selektory przydają się głównie gdy chcemy napisać taktykę rozwiązującą
    wszystkie cele i sprawdzamy jej działanie na każdym celu z osobna. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Goal</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">numgoals</span> <span class="id" title="keyword">in</span> <span class="id" title="tactic">idtac</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">numgoals</span> <span class="id" title="keyword">in</span> <span class="id" title="tactic">idtac</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
Ilość celów możemy policzyć za pomocą taktyki <span class="inlinecode"><span class="id" title="var">numgoals</span></span>. Liczy ona
    wszystkie cele, na które działa, więc jeżeli nie użyjemy żadnego
    selektora, zwróci ona 1. Nie jest ona zbyt użyteczna (poza bardzo
    skomplikowanymi taktykami, które z jakichś powodów nie operują tylko na
    jednym celu, lecz na wszystkich).

<div class="paragraph"> </div>

    Z wiązaniem <span class="inlinecode"><span class="id" title="keyword">let</span></span> w kontekście taktyk spotkamy się już niedługo. 
<div class="paragraph"> </div>

<a name="lab152"></a><h1 class="section">Podstawowe rodzaje bytów</h1>

<div class="paragraph"> </div>

<a name="lab153"></a><h1 class="section">Backtracking</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">existNatFrom</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n</span> || <span class="id" title="var">existNatFrom</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">existNat</span> := <span class="id" title="var">existNatFrom</span> <span class="id" title="var">O</span>.<br/>

<br/>
<span class="id" title="keyword">Goal</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">exists</span></a> <span class="id" title="var">m</span><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a> <a class="idref" href="R3.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> 1.<br/>
&nbsp;&nbsp;<span class="id" title="var">Fail</span> (<span class="id" title="var">existNat</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">existNatFrom'</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n</span> + <span class="id" title="var">existNatFrom'</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">existNat'</span> := <span class="id" title="var">existNatFrom'</span> <span class="id" title="var">O</span>.<br/>

<br/>
<span class="id" title="keyword">Goal</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">exists</span></a> <span class="id" title="var">m</span><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a> <a class="idref" href="R3.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> 15.<br/>
&nbsp;&nbsp;<span class="id" title="var">existNat'</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab154"></a><h1 class="section">Dopasowanie celu</h1>

<div class="paragraph"> </div>

<a name="lab155"></a><h1 class="section">Dopasowanie termu</h1>

<div class="paragraph"> </div>

<a name="lab156"></a><h1 class="section">Inne wesołe rzeczy</h1>

</div>
<div class="code">

<br/>
</div>
